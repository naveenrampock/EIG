<p-growl [(value)]="msgs" life="1000"></p-growl>
<div class="emr-details">
  <div class=" m-b10 ebg-white">
    <div class="head-text">
      <p class="col-sm-12 text-center w-85 pull-left m-0">Procedure</p>
      <a class="pull-right" id="back_Appointment" (click)="backToListing()">
        <button class="addbutton">
          <i class="fa fa-arrow-circle-left"></i>
        </button>
      </a>
    </div>
    <div class="col-sm-12 col-xs-12 no-padd emr-labels" [formGroup]="emrProcedureDetailsForm">
      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">SourceType
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd">
          <!-- <input type='text' (keyup)="searchDropDown(11, src.value)" #src formControlName="SourceType" [(ngModel)]="selectedText" minlength="3"
          />
          <i class="fa fa-caret-down"></i>
          <div *ngIf="sourceTypes && IsHidden" class="emr-dropdown">
            <ul *ngFor="let sType of sourceTypes" (click)="getValue(sType)" class="p-l10 m-b0 brd-b">
              <li>
                {{sType.Description}}
              </li>
            </ul>
          </div> -->
          <select formControlName="SourceType" class="emr-dropdown">
            <option value=''>Select SourceType</option>
            <option *ngFor="let sType of sourceTypes" [value]='sType.Id'>{{sType.Description}}</option>
          </select>
        </div>
      </div>
      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">SourceId</label>
        <div class="col-sm-7 pull-left no-padd">
          <input type="text" formControlName="SourceId" OnlyNumber="true" maxlength="3">
        </div>
      </div>
      <!-- Basic Information -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0">Basic Information</p>
      </div>
      <div class="col-sm-12 no-padd">
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Context</label>
          <div class="col-sm-7 pull-left no-padd">
            <!-- <input type="text" formControlName="Context" maxlength="100"> -->
            <a class="emr_link" (click)="encounter()">Link to Encounter</a>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Code</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(81, src3.value)" #src3 formControlName="Code" [(ngModel)]="selectedCode" minlength="3"
              placeholder="please keyin(eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="code && IsHidden" class="emr-dropdown">
              <ul *ngFor="let cd of code" (click)="getValue(cd)" class="p-l10 m-b0 brd-b">
                <li>
                  {{cd.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10 h-30">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Category
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <!-- <input type='text' (keyup)="searchDropDown(146, src2.value)" #src2 formControlName="Category" [(ngModel)]="selectedCategory"
              minlength="3" />
              <i class="fa fa-caret-down"></i>
            <div *ngIf="category && IsHidden" class="emr-dropdown">
              <ul *ngFor="let cat of category" (click)="getValue(cat)" class="p-l10 m-b0 brd-b">
                <li>
                  {{cat.Description}}
                </li>
              </ul>
            </div> -->
            <select formControlName="Category" class="emr-dropdown">
              <option value=''>Select Category</option>
              <option *ngFor="let cat of category" [value]='cat.Id'>{{cat.Description}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Status
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(73, src1.value)" #src1 formControlName="Status" [(ngModel)]="selectedStatus" minlength="3"
              placeholder="please keyin(eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="appointmentStatus && IsHidden" class="emr-dropdown">
              <ul *ngFor="let status of appointmentStatus" (click)="getValue(status)" class="p-l10 m-b0 brd-b">
                <li>
                  {{status.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">BasedOn
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="BasedOn" maxlength="40" placeholder="BasedOn">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">PartOf
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="PartOf" maxlength="50" placeholder="PartOf">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Definition
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="Definition" maxlength="25" placeholder="Definition">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Report</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="Report" maxlength="100"  style="display:none">
            <a class="emr_link" (click)="diagnostic()">Link to Diagnostic</a>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">BodySite</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(76, src4.value)" #src4 formControlName="BodySite" [(ngModel)]="selectedBodySite"
              minlength="3" placeholder="please keyin(eg:a)" />
            <div *ngIf="bodySite && IsHidden" class="emr-dropdown">
              <ul *ngFor="let bds of bodySite" (click)="getValue(bds)" class="p-l10 m-b0 brd-b">
                <li>
                  {{bds.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Outcome</label>
          <div class="col-sm-7 pull-left no-padd">
            <!-- <input type='text' (keyup)="searchDropDown(77, src6.value)" #src6 formControlName="Outcome" [(ngModel)]="selectedOutcome"
              minlength="3" />
              <i class="fa fa-caret-down"></i>
            <div *ngIf="outcome && IsHidden" class="emr-dropdown">
              <ul *ngFor="let out of outcome" (click)="getValue(out)" class="p-l10 m-b0 brd-b">
                <li>
                  {{out.Description}}
                </li>
              </ul>
            </div> -->
            <select formControlName="Outcome" class="emr-dropdown">
              <option value=''>Select Outcome</option>
              <option *ngFor="let out of outcome" [value]='out.Id'>{{out.Description}}</option>
            </select>
          </div>
        </div>

        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">FocalDevice</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="FocalDevice" maxlength="100" placeholder="FocalDevice">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Note</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="Note" maxlength="100" placeholder="Note">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Location</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="Location" maxlength="100" placeholder="Location">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">FollowUp</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(79, src8.value)" #src8 formControlName="FollowUp" [(ngModel)]="selectedFollowUp"
              minlength="3" placeholder="please keyin(eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="followUp && IsHidden" class="emr-dropdown">
              <ul *ngFor="let fup of followUp" (click)="getValue(fup)" class="p-l10 m-b0 brd-b">
                <li>
                  {{fup.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Summary</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="Location" maxlength="100" placeholder="Location">
          </div>
        </div>
      </div>
      <!-- Reason Information -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0">Reason Information</p>
      </div>
      <div class="col-sm-12 no-padd">
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">ReasonCode</label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(75, src5.value)" #src5 formControlName="ReasonCode" [(ngModel)]="selectedReasonCode"
              minlength="3" placeholder="please keyin(eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="reasonCode && IsHidden" class="emr-dropdown">
              <ul *ngFor="let rcd of reasonCode" (click)="getValue(rcd)" class="p-l10 m-b0 brd-b">
                <li>
                  {{rcd.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-sm-8 pull-left m-b10 m-t10">
          <label class="col-sm-3 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">ReasonReference</label>
          <div class="col-sm-7 pull-left no-padd">
            <!-- <input type="text" formControlName="ReasonReference" maxlength="100"> -->
            <a class="emr_link" (click)="condition()">Link to Conditions</a> /
            <a class="emr_link" (click)="observation()">Observations </a>
          </div>
        </div>
      </div>

      <!-- Compilation Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0">Compilation Details </p>
      </div>
      <div class="col-sm-12 no-padd">
        <div class="col-sm-12 pull-left m-b10 m-t10">
          <label class="lbl_note pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">ComplicationDetail</label>
          <div class="txt_note pull-left no-padd">
            <!-- <input type="text" formControlName="ComplicationDetail" maxlength="100"> -->
            <a class="emr_link" (click)="condition1()">Link to Conditions Details</a>
          </div>
        </div>
      </div>
      <!-- Performed Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0 col-sm-6 no-padd pull-left">Performed Details </p>
        <div class="col-sm-6 no-padd pull-left" [class.disabled]="emrProcedureDetailsForm.get('Performed').controls.length > 4">
          <a class="text-right pull-right add_effective" (click)="addDetails()">
            <i id="add" class="fa fa-plus"></i>
          </a>
        </div>
      </div>
      <div formArrayName="Performed" *ngFor="let item of emrProcedureDetailsForm.get('Performed').controls; let i = index;">
        <div [formGroupName]="i">
          <div class="col-sm-4 pull-left m-b10 m-t10">
            <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Period</label>
            <div class="col-sm-7 pull-left no-padd">
              <input type="text" formControlName="Performed" maxlength="100" placeholder="Performed">
            </div>
          </div>
          <div class="col-sm-4 pull-left m-b10 m-t10">
            <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Date Time</label>
            <div class="col-sm-7 pull-left no-padd">
              <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1910:2020" showButtonBar="true" dateFormat="mm-dd-yy"
                placeholder="mm-dd-yyyy" formControlName="PerformedDateTime" [showIcon]="true"></p-calendar>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10"></div>
        <a class="col-sm-2 pull-left m-b10 m-t10 delbtn" *ngIf="emrProcedureDetailsForm.get('Performed').controls.length >1"
          (click)="deleteDetails(i)">
          <i class="fa fa-trash trash"></i>
        </a>
      </div>
    </div>
    <!-- Encounter Screen -->
    <p-dialog header="Link to Encounter" [(visible)]="encounterScreen" [responsive]="true" showEffect="fade" [modal]="true" [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="emrEncounterLists">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectedAllEncounter" (change)="selectAllEncounter()">
            </th>
            <th>Period From</th>
            <th>Period To</th>
            <th>Priority</th>
            <th>Type</th>
            <th>Service Provider</th>
            <th>Status</th>
          </tr>

        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-i="rowIndex">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" (change)="checkIfAllEncounterSelected()" [(ngModel)]="rowData.selected"> </td>
            <td>{{rowData.PeriodStart |date:'MM/dd/yyyy'}}</td>
            <td>{{rowData.PeriodEnd |date:'MM/dd/yyyy'}}</td>
            <td>{{rowData.Priority}}</td>
            <td>{{rowData.Typeesc}}</td>
            <td>{{rowData.ServiceProvider}}</td>
            <td>{{rowData.StatusDesc}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveEncounterScreen()">Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <!-- Diagnostic Report -->
    <p-dialog header="Link to Diagnostic Report" [(visible)]="diagnosticScreen" [responsive]="true" showEffect="fade" [modal]="true"
      [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="diagnosticList">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectedAllDiagnostic" (change)="selectDiagnostic()">
            </th>
            <th>Code</th>
            <th>Category</th>
            <th>Issued</th>
            <th>Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllDiagnsticSelected()"> </td>
            <td>{{rowData.Code}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.Issued | date:'MM/dd/yyyy' }}</td>
            <td>{{rowData.Status}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveDiagnosticScreen()">Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <!--Observation-->
    <p-dialog header="Link to Observation" [(visible)]="observationScreen" [responsive]="true" showEffect="fade" [modal]="true"
      [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="listEmrObservation">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectAllObservation" (change)="selectObservation()">
            </th>
            <th>Performer</th>
            <th>Identifier</th>
            <th>BodySite</th>
            <th>Code</th>
            <th>Category</th>
            <th>Issued On</th>
            <th>Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllObservationSelected()"> </td>
            <td>{{rowData.Performer}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.BodySite }}</td>
            <td>{{rowData.Code}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.Issued}}</td>
            <td>{{rowData.Status}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveObservationScreen()">Save</button>
        </div>
      </p-footer>
    </p-dialog>
    <!-- Condition -->
    <p-dialog header="Link to Condition" [(visible)]="conditionScreen" [responsive]="true" showEffect="fade" [modal]="true" [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="conditionList">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectAllCondition" (change)="selectCondition()">
            </th>
            <th>Condition</th>
            <th>Context</th>
            <th>Description</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllConditionSelected()"> </td>
            <td>{{rowData.Id}}</td>
            <td>{{rowData.Context}}</td>
            <td>{{rowData.Abatement}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveConditionScreen()">Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <div class="col-sm-12 text-right m-b10 inline-block" *ngIf="ProcedureDetails?.mode !=='readOnly'">
      <button class="btn btn-primary clr-white m-b10" (click)="!ProcedureDetails ? saveEmrProcedure() : updateEmrProcedure()" [disabled]="!emrProcedureDetailsForm.valid">{{!ProcedureDetails ? 'Save' : 'Update'}}</button>
    </div>
    <!-- {{emrProcedureDetailsForm.value | json}} -->
  </div>
</div>