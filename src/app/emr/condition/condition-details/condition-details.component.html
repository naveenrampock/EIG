<p-growl [(value)]="msgs" life="3000"></p-growl>
<div class="emr-details">
  <div class=" m-b10 ebg-white">
    <div class="head-text inline-block">
      <p class="col-sm-12 text-center w-85 pull-left m-0">Condition</p>
      <a class="pull-right" id="back_condition" (click)="backToListing()">
        <button class="addbutton">
          <i class="fa fa-arrow-circle-left"></i>
        </button>
      </a>
    </div>
    <div class="col-sm-12 col-xs-12 emr-labels no-padd inline-block" [formGroup]="conditionForm">
      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">SourceType
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd" [class.disabled]="isReadOnly">
          <select formControlName="sourceType" class="emr-dropdown">
            <option value=''>Select Source Type</option>
            <option *ngFor="let sType of sourceDrp" [value]='sType.Id'>{{sType.Description}}</option>
          </select>
        </div>
      </div>
      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">SourceID</label>
        <div class="col-sm-7 pull-left no-padd">
          <div class="input-group g-brd-primary--focus">
            <input class="form-control form-control-md g-py-13 rounded-0 pr-0" type="text" OnlyNumber="true" maxlength="3" placeholder="SourceID"
              formControlName="sourceId">
          </div>
        </div>
      </div>
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0">Basic Information</p>
      </div>
      <div class="col-sm-12 no-padd">
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Name
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="name" maxlength="50" placeholder="Name">
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd single-line">Context
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type="text" formControlName="context" style="display:none">
            <a class="emr_link" (click)="encounterPage()">Link to encounter</a>
          </div>
        </div>
      </div>
      <div class="col-sm-12 no-padd">
        <div class="col-sm-4 pull-left m-b10 m-t10 h-30">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Subject
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <select formControlName="subject" class="emr-dropdown">
              <option value=''>Select Subject</option>
              <option *ngFor="let pType of contactsLists" [value]='pType.Id'>{{pType.AccountID}}</option>
            </select>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Body Site
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(68, src6.value)" #src6 formControlName="bodySite" [(ngModel)]="selectedBodySite"
              minlength="3" placeholder="please keyin (eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="bodysite && IsHidden" class="emr-dropdown z-index999">
              <ul *ngFor="let bodyType of bodysite" (click)="getValue(bodyType)" class="p-l10 m-b0 brd-b">
                <li>
                  {{bodyType.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>

        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Code
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(67, src5.value)" #src5 formControlName="code" [(ngModel)]="selectedCode" minlength="3"
              placeholder="please keyin (eg:a)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="codeDrp && IsHidden" class="emr-dropdown z-index999">
              <ul *ngFor="let code of codeDrp" (click)="getValue(code)" class="p-l10 m-b0 brd-b">
                <li>
                  {{code.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-4 pull-left m-b10 m-t10 h-30">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Category
            <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <select formControlName="category" class="emr-dropdown">
              <option value=''>Select Category</option>
              <option *ngFor="let category of conditionDrp" [value]='category.Id'>{{category.Description}}</option>
            </select>
          </div>
        </div>
      </div>


      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Severity
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd">
          <select formControlName="severity" class="emr-dropdown">
            <option value=''>Select Severity</option>
            <option *ngFor="let severity of severityDrp" [value]='severity.Id'>{{severity.Description}}</option>
          </select>
        </div>
      </div>
      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Clinical Status
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd">
          <select formControlName="clinicalStatus" class="emr-dropdown">
            <option value=''>Select Clinical Status</option>
            <option *ngFor="let cType of clinicalDrp" [value]='cType.Id'>{{cType.Description}}</option>
          </select>
        </div>
      </div>

      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 single-line pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Verification Status
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd">
          <select formControlName="verificationStatus" class="emr-dropdown">
            <option value=''>Select Verification Status</option>
            <option *ngFor="let vType of verificationDrp" [value]='vType.Id'>{{vType.Description}}</option>
          </select>
        </div>
      </div>

      <div class="col-sm-4 pull-left m-b10 m-t10">
        <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Asserter Date
          <span class="required">*</span>
        </label>
        <div class="col-sm-7 pull-left no-padd">
          <p-calendar [monthNavigator]="true" [yearNavigator]="true" yearRange="1910:2020" showButtonBar="true" dateFormat="mm-dd-yy"
            placeholder="mm-dd-yyyy" [showIcon]="true" [maxDate]="minSDate" formControlName="assertedDate" class="pull-left"></p-calendar>
        </div>
      </div>

      <!-- Abatement Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0"> Abatement Details</p>
      </div>
      <div class="col-sm-12 pull-left m-b10 m-t10">
        <label class="lbl_note pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Description
        </label>
        <div class="txt_note pull-left no-padd">
          <input type="text" formControlName="abatement" class="w-100" maxlength="100" placeholder="Description">
        </div>
      </div>

      <!-- Stage Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0"> Stage</p>
      </div>

      <div class="col-sm-12 no-padd" formGroupName="stage">
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Summary
              <span class="required">*</span>
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(69, src7.value)" #src7 formControlName="summery" [(ngModel)]="selectsummery" minlength="3"
              placeholder="please key in (eg:t)" />
            <i class="fa fa-caret-down"></i>
            <div *ngIf="summary && IsHidden" class="emr-dropdown">
              <ul *ngFor="let sumType of summary" (click)="getValue(sumType)" class="p-l10 m-b0 brd-b">
                <li>
                  {{sumType.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-8 pull-left m-b10 m-t10">
          <label class="lbl_note pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Assessment
              <span class="required">*</span>
          </label>
          <div class="w-80 pull-left">
            <input type="text" formControlName="assessment" style="display:none">
            <a class="emr_link m-r5">Link to</a>
            <a class="emr_link m-r5" (click)="diagnosticReport()">Diagnostic Report</a>
            <a class="emr_link m-r5" (click)="observationPage()">Observation</a>
          </div>
        </div>
      </div>
      <!-- Evidence Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0"> Evidence Details</p>
      </div>
      <div class="col-sm-12 no-padd" formGroupName="evidence">
        <div class="col-sm-4 pull-left m-b10 m-t10">
          <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Code
          </label>
          <div class="col-sm-7 pull-left no-padd">
            <input type='text' (keyup)="searchDropDown(163, src8.value)" #src8 formControlName="evidenceCode" [(ngModel)]="selectevidenceCode"
              minlength="3" placeholder="please keyin (eg:a)" />
            <div *ngIf="expCode && IsHidden" class="emr-dropdown">
              <ul *ngFor="let ecType of expCode" (click)="getValue(ecType)" class="p-l10 m-b0 brd-b">
                <li>
                  {{ecType.Description}}
                </li>
              </ul>
            </div>
          </div>
        </div>
        <div class="col-sm-8 pull-left m-b10 m-t10">
          <label class="lbl_note pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Detail
          </label>
          <div class="w-80 pull-left">
            <input type="text" formControlName="evidenceDetail" class="w-100" maxlength="100" placeholder="Details">
          </div>
        </div>
      </div>
      <!-- Note Details -->
      <div class="head-text subhead inline-block">
        <p class="normal pull-left m-0"> Note</p>
      </div>
      <div class="col-sm-12 no-padd m-b10 m-t10">
        <!-- <label class="col-sm-5 pull-left col-form-label g-color-gray-dark-v2 text-sm-left no-padd">Note
          </label> -->
        <div class="col-sm-12 pull-left m-b10 m-t10">
          <input type="text" formControlName="note" maxlength="50" class="w-100" placeholder="Note">
        </div>
      </div>

    </div>
    <!-- Encounter Screen -->
    <p-dialog header="Link to Encounter" [(visible)]="encounterScreen" [responsive]="true" showEffect="fade" [modal]="true" [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="emrEncounterLists">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectedAllEncounter" (change)="selectAllEncounter()" [disabled]="!encounterlink">
            </th>
            <th>Period From</th>
            <th>Period To</th>
            <th>Priority</th>
            <th>Type</th>
            <th>Service Provider</th>
            <th>Status</th>
          </tr>

        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns" let-i="rowIndex">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllEncounterSelected()" [disabled]="!encounterlink"> </td>
            <td>{{rowData.PeriodStart |date:'MM/dd/yyyy'}}</td>
            <td>{{rowData.PeriodEnd |date:'MM/dd/yyyy'}}</td>
            <td>{{rowData.Priority}}</td>
            <td>{{rowData.TypeDesc}}</td>
            <td>{{rowData.ServiceProvider}}</td>
            <td>{{rowData.StatusDesc}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveEncounterScreen()" [disabled]="!encounterlink" >Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <!-- Diagnostic Report -->
    <p-dialog header="Link to Diagnostic Report" [(visible)]="diagnosticScreen" [responsive]="true" showEffect="fade" [modal]="true"
      [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="diagnosticList">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectedAllDiagnostic" (change)="selectAllDiagnostic()" [disabled]="!encounterlink">
            </th>
            <th>Code</th>
            <th>Category</th>
            <th>Issued</th>
            <th>Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllDiagnsticSelected()" [disabled]="!encounterlink"> </td>
            <td>{{rowData.Code}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.Issued | date:'MM/dd/yyyy' }}</td>
            <td>{{rowData.Status}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveDiagnosticScreen()" [disabled]="!encounterlink">Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <!--Observation-->
    <p-dialog header="Link to Observation" [(visible)]="observationScreen" [responsive]="true" showEffect="fade" [modal]="true"
      [width]="800">
      <p-table #dt [columns]="tableHeaders" [value]="listEmrObservation">
        <ng-template pTemplate="header" let-columns>
          <tr role="row">
            <th>
              <input type="checkbox" [(ngModel)]="selectedAll" (change)="selectAll()" [disabled]="!encounterlink">
            </th>
            <th>Performer</th>
            <th>Identifier</th>
            <th>BodySite</th>
            <th>Code</th>
            <th>Category</th>
            <th>Issued On</th>
            <th>Status</th>
          </tr>
        </ng-template>
        <ng-template pTemplate="body" let-rowData let-columns="columns">
          <tr [pSelectableRow]="rowData">
            <td>
              <input type="checkbox" [(ngModel)]="rowData.selected" (change)="checkIfAllSelected()" [disabled]="!encounterlink"> </td>
            <td>{{rowData.Performer}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.BodySite }}</td>
            <td>{{rowData.Code}}</td>
            <td>{{rowData.Category}}</td>
            <td>{{rowData.Issued}}</td>
            <td>{{rowData.Status}}</td>
          </tr>
        </ng-template>
      </p-table>
      <p-footer>
        <div class="ui-dialog-buttonpane ui-helper-clearfix popup">
          <button class="btn pull-right pButton" type="button" (click)="saveObservationScreen()" [disabled]="!encounterlink">Save</button>
        </div>
      </p-footer>
    </p-dialog>

    <div class="col-sm-12 text-right m-b10 inline-block" *ngIf="conditionDetails?.mode !== 'readOnly'">
      <button class="btn btn-primary clr-white m-b10" [disabled]="!conditionForm.valid" (click)="!conditionDetails ? insertCondition(conditionForm.value) : updateCondition(conditionForm.value)">{{!conditionDetails ? 'Save' : 'Update'}}</button>
    </div>
  </div>
</div>